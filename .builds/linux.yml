image: archlinux
packages:
- python
- wget
sources:
- https://git.sr.ht/~ddavis/dask-histogram
tasks:
- setup: |
    wget -nv https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O mc3.sh
    bash mc3.sh -b -p $HOME/miniconda
    source $HOME/miniconda/etc/profile.d/conda.sh
    conda config --set always_yes yes --set changeps1 no
    conda create -q -n testenv python=3.8 pytest dask boost-histogram -c conda-forge
- test: |
    cd dask-histogram
    source $HOME/miniconda/etc/profile.d/conda.sh
    conda activate testenv
    pip install .
    pytest
